<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Backstage Pass</title>
  <meta property="og:image" content="https://backstagepass.co.in/newlogo.webp" />
  <meta property="og:type" content="website">

  <!-- Font Optimization -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" media="print"
    onload="this.media='all'" />
  <noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" />
  </noscript>

  <!-- âœ… LCP Image Preloads -->
  <!-- Mobile -->
  <link rel="preload" as="image" href="/images/mobile/NewCampus.webp" media="(max-width:768px)" fetchpriority="high" />
  <!-- Desktop -->
  <link rel="preload" as="image" href="/images/banners/NewCampus.webp" media="(min-width:769px)" fetchpriority="high" />

  <!-- Defer GTM -->
  <script>
    window.addEventListener('load', () => {
      (function (w, d, s, l, i) {
        w[l] = w[l] || []; w[l].push({
          'gtm.start':
            new Date().getTime(), event: 'gtm.js'
        }); var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
            'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-P8SQ3BS');
    });
  </script>

  <!-- Defer Microsoft Clarity -->
  <script>
    if ('requestIdleCallback' in window) {
      requestIdleCallback(() => {
        (function (c, l, a, r, i, t, y) {
          c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
          t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
          y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
        })(window, document, "clarity", "script", "mo8baddgve");
      });
    }
  </script>

  <!-- Facebook Pixel Script -->
  <script>
    window.fbq = function () {
      window.fbq.callMethod
        ? window.fbq.callMethod.apply(window.fbq, arguments)
        : window.fbq.queue.push(arguments);
    };
    window.fbq.push = window.fbq;
    window.fbq.loaded = true;
    window.fbq.version = '2.0';
    window.fbq.queue = [];

    window.addEventListener('load', () => {
      const fb = document.createElement('script');
      fb.async = true;
      fb.src = 'https://connect.facebook.net/en_US/fbevents.js';
      fb.onload = () => {
        fbq('init', '8236983926348899');
        fbq('track', 'PageView');
      };
      document.head.appendChild(fb);
    });
  </script>

  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=8236983926348899&ev=PageView&noscript=1" />
  </noscript>

  <!-- Matomo Tag Manager -->
  <script>
    var _mtm = window._mtm = window._mtm || [];
    _mtm.push({ 'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start' });
    (function () {
      var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];
      g.async = true; g.src = 'https://cdn.matomo.cloud/backstagepass.matomo.cloud/container_Fa2LaVPH.js'; s.parentNode.insertBefore(g, s);
    })();
  </script>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      requestIdleCallback(() => {
        document.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
          const href = link.getAttribute('href');
          if (href && href.includes('.chunk.css')) {
            const preload = document.createElement('link');
            preload.rel = 'preload';
            preload.as = 'style';
            preload.href = href;
            preload.onload = function () {
              this.rel = 'stylesheet';
            };
            preload.onerror = function () {
              this.rel = 'stylesheet';
            };
            link.remove();
            document.head.appendChild(preload);
          }
        });
      });
    });
  </script>

</head>

<body>
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P8SQ3BS" height="0" width="0"
      style="display:none;visibility:hidden"></iframe>
  </noscript>

  <!-- âœ… LCP Banner -->
  <picture>
    <source srcset="/images/mobile/NewCampus.webp" media="(max-width:768px)" />
    <img src="/images/banners/NewCampus.webp" alt="Home Banner" width="1526" height="450" loading="eager"
      fetchpriority="high" style="width:100%;height:auto;" />
  </picture>

  <div id="root"></div>

  <!-- React chunk cache cleanup -->
  <script>
    (async function () {
      try {
        const currentChunks = Array.from(document.querySelectorAll('script[src*=".chunk."]'))
          .map(s => s.src.split('/').pop())
          .sort()
          .join(',');

        const previousChunks = localStorage.getItem('react_build_chunks');

        if (previousChunks && previousChunks !== currentChunks) {
          console.log('ðŸ§¹ New React build detected â€” clearing old cached chunks...');
          if ('caches' in window) {
            const cacheNames = await caches.keys();
            await Promise.all(cacheNames.map(name => caches.delete(name)));
          }
          localStorage.clear();
          sessionStorage.clear();
          location.reload(true);
        }

        localStorage.setItem('react_build_chunks', currentChunks);
      } catch (e) {
        console.warn('Cache cleanup failed:', e);
      }
    })();
  </script>

</body>

</html>
